# Starter pipeline

# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

variables:

  BuildConfiguration: 'Release'

steps:

- task: gittools.gitversion.gitversion-task.GitVersion@5
  displayName: GitVersion
  inputs:
    preferBundledVersion: false

- task: DotNetCoreCLI@2
  displayName: Build
  inputs:
    command: 'build'
    projects: 'Solutions/Corvus.Extensions.sln'
    arguments: '/p:VersionPrefix="$(GitVersion.MajorMinorPatch)" /p:VersionSuffix="$(GitVersion.PreReleaseTag)" --configuration $(BuildConfiguration) '

- task: DotNetCoreCLI@2
  displayName: Executable Specifications
  inputs:
    command: 'test'
    projects: 'Solutions/Corvus.Extensions.sln'
    arguments: '-c $(BuildConfiguration) --no-build --no-restore /p:VersionPrefix="$(GitVersion.MajorMinorPatch)" /p:VersionSuffix="$(GitVersion.PreReleaseTag)"'

- task: DotNetCoreCLI@2
  displayName: Create Nuget Packages
  inputs:
    command: 'pack'
    projects: 'Solutions/Corvus.Extensions.sln'
    packDirectory: '$(Build.ArtifactStagingDirectory)/packages/$(Build.BuildID)'
    nobuild: true
    buildProperties: 'VersionPrefix="$(GitVersion.MajorMinorPatch)";VersionSuffix="$(GitVersion.PreReleaseTag)"'